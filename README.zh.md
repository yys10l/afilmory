# Afilmory

Afilmory (/É™ËˆfÉªlmÉ™ri/, "uh-FIL-muh-ree") æ˜¯ä¸€ä¸ªä¸ºä¸ªäººæ‘„å½±ç½‘ç«™åˆ›é€ çš„æœ¯è¯­ï¼Œèåˆäº†å¯¹ç„¦ (AF)ã€å…‰åœˆï¼ˆå…‰çº¿æ§åˆ¶ï¼‰ã€èƒ¶ç‰‡ï¼ˆå¤å¤åª’ä»‹ï¼‰å’Œè®°å¿†ï¼ˆæ•æ‰çš„ç¬é—´ï¼‰ã€‚

ä¸€ä¸ªç°ä»£åŒ–çš„ç…§ç‰‡ç”»å»Šç½‘ç«™ï¼Œé‡‡ç”¨ React + TypeScript æ„å»ºï¼Œæ”¯æŒä»å¤šç§å­˜å‚¨æºï¼ˆS3ã€GitHubï¼‰è‡ªåŠ¨åŒæ­¥ç…§ç‰‡ï¼Œå…·æœ‰é«˜æ€§èƒ½ WebGL æ¸²æŸ“ã€ç€‘å¸ƒæµå¸ƒå±€ã€EXIF ä¿¡æ¯å±•ç¤ºã€ç¼©ç•¥å›¾ç”Ÿæˆç­‰åŠŸèƒ½ã€‚

çº¿ä¸Šç…§ç‰‡å¢™ï¼š

- https://gallery.innei.in
- https://gallery.mxte.cc
- https://photography.pseudoyu.com

## ğŸŒŸ ç‰¹æ€§

### æ ¸å¿ƒåŠŸèƒ½

- ğŸ–¼ï¸ **é«˜æ€§èƒ½ WebGL å›¾åƒæ¸²æŸ“å™¨** - åŸºäºè‡ªç ” WebGL ç»„ä»¶ï¼Œæ”¯æŒæµç•…çš„ç¼©æ”¾ã€å¹³ç§»æ“ä½œ
- ğŸ“± **å“åº”å¼ç€‘å¸ƒæµå¸ƒå±€** - é‡‡ç”¨ Masonic å®ç°ï¼Œè‡ªé€‚åº”ä¸åŒå±å¹•å°ºå¯¸
- ğŸ¨ **ç°ä»£åŒ– UI è®¾è®¡** - åŸºäº Tailwind CSS å’Œ Radix UI ç»„ä»¶åº“
- âš¡ **å¢é‡åŒæ­¥** - æ™ºèƒ½æ£€æµ‹æ–‡ä»¶å˜åŒ–ï¼Œä»…å¤„ç†æ–°å¢æˆ–ä¿®æ”¹çš„ç…§ç‰‡
- ğŸŒ **i18n** - æ”¯æŒå¤šè¯­è¨€

### å›¾åƒå¤„ç†

- ğŸ”„ **HEIC/HEIF æ ¼å¼æ”¯æŒ** - è‡ªåŠ¨è½¬æ¢ Apple è®¾å¤‡çš„ HEIC æ ¼å¼
- ğŸ–¼ï¸ **æ™ºèƒ½ç¼©ç•¥å›¾ç”Ÿæˆ** - å¤šå°ºå¯¸ç¼©ç•¥å›¾ï¼Œä¼˜åŒ–åŠ è½½æ€§èƒ½
- ğŸ“Š **EXIF ä¿¡æ¯å±•ç¤º** - å®Œæ•´çš„æ‹æ‘„å‚æ•°ï¼ŒåŒ…æ‹¬ç›¸æœºå‹å·ã€ç„¦è·ã€å…‰åœˆç­‰
- ğŸŒˆ **Blurhash å ä½ç¬¦** - ä¼˜é›…çš„å›¾ç‰‡åŠ è½½ä½“éªŒ
- ğŸ“± **Live Photo æ”¯æŒ** - æ£€æµ‹å¹¶å±•ç¤º iPhone Live Photo

### é«˜çº§åŠŸèƒ½

- ğŸ›ï¸ **å¯Œå£«èƒ¶ç‰‡æ¨¡æ‹Ÿ** - è¯»å–å’Œå±•ç¤ºå¯Œå£«ç›¸æœºçš„èƒ¶ç‰‡æ¨¡æ‹Ÿè®¾ç½®
- ğŸ” **å…¨å±æŸ¥çœ‹å™¨** - æ”¯æŒæ‰‹åŠ¿æ“ä½œçš„å›¾ç‰‡æŸ¥çœ‹å™¨
- ğŸ·ï¸ **æ™ºèƒ½æ ‡ç­¾** - åŸºäº EXIF æ•°æ®è‡ªåŠ¨ç”Ÿæˆæ ‡ç­¾
- âš¡ **å¹¶å‘å¤„ç†** - æ”¯æŒå¤šè¿›ç¨‹/å¤šçº¿ç¨‹å¹¶å‘å¤„ç†
- ğŸ—‚ï¸ **å¤šå­˜å‚¨æ”¯æŒ** - S3ã€GitHub ç­‰å¤šç§å­˜å‚¨åç«¯

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

### å‰ç«¯æŠ€æœ¯æ ˆ

- **React 19** - ä½¿ç”¨æœ€æ–°çš„ React ç‰ˆæœ¬å’Œ Compiler
- **TypeScript** - å®Œæ•´çš„ç±»å‹å®‰å…¨
- **Vite** - ç°ä»£åŒ–æ„å»ºå·¥å…·
- **Tailwind CSS** - åŸå­åŒ– CSS æ¡†æ¶
- **Radix UI** - æ— éšœç¢ç»„ä»¶åº“
- **Jotai** - çŠ¶æ€ç®¡ç†
- **TanStack Query** - æ•°æ®è·å–å’Œç¼“å­˜
- **React Router 7** - è·¯ç”±ç®¡ç†
- **i18next** - å›½é™…åŒ–

### æ„å»ºç³»ç»Ÿ

- **Node.js** - æœåŠ¡ç«¯è¿è¡Œæ—¶
- **Sharp** - é«˜æ€§èƒ½å›¾åƒå¤„ç†
- **AWS SDK** - S3 å­˜å‚¨æ“ä½œ
- **Worker Threads/Cluster** - å¹¶å‘å¤„ç†
- **EXIF-Reader** - EXIF æ•°æ®æå–

### å­˜å‚¨æ¶æ„

é‡‡ç”¨é€‚é…å™¨æ¨¡å¼è®¾è®¡ï¼Œæ”¯æŒå¤šç§å­˜å‚¨åç«¯ï¼š

- **S3 å…¼å®¹å­˜å‚¨** - AWS S3ã€MinIOã€é˜¿é‡Œäº‘ OSS ç­‰
- **GitHub å­˜å‚¨** - ä½¿ç”¨ GitHub ä»“åº“ä½œä¸ºå›¾ç‰‡å­˜å‚¨

## ğŸš€ å¿«é€Ÿå¼€å§‹

### Docker éƒ¨ç½²

[Docker éƒ¨ç½²](https://github.com/Afilmory/docker)

### ç¯å¢ƒè¦æ±‚

- Node.js 18+
- è‡³å°‘ 4GB RAMï¼ˆç”¨äºå›¾åƒå¤„ç†ï¼‰

### 1. å…‹éš†é¡¹ç›®

```bash
git clone https://github.com/Afilmory/Afilmory.git
cd photo-gallery-site
```

### 2. å®‰è£…ä¾èµ–

```bash
pnpm install
```

### 3. ç¯å¢ƒé…ç½®

åˆ›å»º `.env` æ–‡ä»¶ï¼š

```env
# S3 å­˜å‚¨é…ç½®
S3_REGION=us-east-1
S3_ACCESS_KEY_ID=your_access_key_id
S3_SECRET_ACCESS_KEY=your_secret_access_key
S3_ENDPOINT=https://s3.amazonaws.com
S3_BUCKET_NAME=your_bucket_name
S3_PREFIX=photos/
S3_CUSTOM_DOMAIN=your_custom_domain.com
S3_EXCLUDE_REGEX=
```

### 4. ç«™ç‚¹é…ç½®

å¤åˆ¶å¹¶ç¼–è¾‘é…ç½®æ–‡ä»¶ï¼š

```bash
cp config.example.json config.json
```

ç¼–è¾‘ `config.json`ï¼š

```json
{
  "name": "æˆ‘çš„ç…§ç‰‡ç”»å»Š",
  "title": "æˆ‘çš„ç…§ç‰‡ç”»å»Š",
  "description": "è®°å½•ç”Ÿæ´»ä¸­çš„ç¾å¥½ç¬é—´",
  "url": "https://gallery.example.com",
  "accentColor": "#007bff", // å¯é€‰, è®¾ç½®ä¸»é¢˜è‰²
  "author": {
    "name": "Your Name", // å¿…å¡«, è®¾ç½®ä½œè€…åç§°
    "url": "https://example.com", // å¯é€‰, è®¾ç½®ä½œè€…ä¸»é¡µ
    "avatar": "https://example.com/avatar.png" // å¯é€‰, è®¾ç½®ä½œè€…å¤´åƒ
  },
  "social": {
    "twitter": "@yourusername" // å¯é€‰, è®¾ç½®ç¤¾äº¤è´¦å·
  }
}
```

### 5. æ„å»ºç…§ç‰‡æ¸…å•

```bash
# é¦–æ¬¡æ„å»º
pnpm run build:manifest

# å¢é‡æ›´æ–°
pnpm run build:manifest

# å¼ºåˆ¶å…¨é‡æ›´æ–°
pnpm run build:manifest -- --force
```

### 6. å¯åŠ¨å¼€å‘æœåŠ¡å™¨

```bash
pnpm dev
```

## âš™ï¸ é…ç½®é€‰é¡¹

### æ„å»ºå™¨é…ç½®

åˆ›å»º `builder.config.json` æ–‡ä»¶è¿›è¡Œé«˜çº§é…ç½®ï¼š

```json
{
  "repo": {
    "enable": false,
    "url": "https://github.com/username/gallery-assets"
  },
  "storage": {
    "provider": "s3",
    "bucket": "my-photos",
    "region": "us-east-1",
    "prefix": "photos/",
    "customDomain": "https://cdn.example.com"
  },
  "options": {
    "defaultConcurrency": 8,
    "enableLivePhotoDetection": true,
    "showProgress": true,
    "showDetailedStats": true
  },
  "logging": {
    "verbose": true,
    "level": "info",
    "outputToFile": false
  },
  "performance": {
    "worker": {
      "workerCount": 8,
      "timeout": 30000,
      "useClusterMode": true,
      "workerConcurrency": 2
    }
  }
}
```

### é…ç½®é€‰é¡¹è¯´æ˜

#### å­˜å‚¨é…ç½® (`storage`)

- `provider`: å­˜å‚¨æä¾›å•† (`s3` | `github`)
- `bucket`: S3 å­˜å‚¨æ¡¶åç§°
- `region`: S3 åŒºåŸŸ
- `endpoint`: S3 ç«¯ç‚¹ï¼ˆå¯é€‰ï¼‰
- `prefix`: æ–‡ä»¶å‰ç¼€
- `customDomain`: è‡ªå®šä¹‰åŸŸå
- `excludeRegex`: æ’é™¤æ–‡ä»¶çš„æ­£åˆ™è¡¨è¾¾å¼ï¼ˆå¯é€‰ï¼‰

#### æ„å»ºé€‰é¡¹ (`options`)

- `defaultConcurrency`: é»˜è®¤å¹¶å‘æ•°
- `enableLivePhotoDetection`: å¯ç”¨ Live Photo æ£€æµ‹
- `showProgress`: æ˜¾ç¤ºæ„å»ºè¿›åº¦
- `showDetailedStats`: æ˜¾ç¤ºè¯¦ç»†ç»Ÿè®¡ä¿¡æ¯

#### æ€§èƒ½é…ç½® (`performance`)

- `worker.workerCount`: Worker è¿›ç¨‹æ•°
- `worker.timeout`: Worker è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
- `worker.useClusterMode`: å¯ç”¨é›†ç¾¤æ¨¡å¼

#### æ—¥å¿—é…ç½® (`logging`)

- `verbose`: è¯¦ç»†æ—¥å¿—
- `level`: æ—¥å¿—çº§åˆ« (`info` | `warn` | `error` | `debug`)
- `outputToFile`: è¾“å‡ºåˆ°æ–‡ä»¶

### è¿œç¨‹èµ„æºåº“é…ç½®

å¦‚æœä½ æœ‰ç‹¬ç«‹çš„èµ„æºä»“åº“å­˜å‚¨ç¼©ç•¥å›¾å’Œæ¸…å•ï¼š

```json
{
  "repo": {
    "enable": true,
    "url": "https://github.com/username/gallery-assets"
  }
}
```

è¿™å°†è‡ªåŠ¨ä»è¿œç¨‹ä»“åº“æ‹‰å–èµ„æºï¼Œé¿å…æ¯æ¬¡æ„å»ºã€‚

## ğŸ“‹ CLI å‘½ä»¤

### æ„å»ºå‘½ä»¤

```bash
# æŸ¥çœ‹å¸®åŠ©
pnpm run build:manifest -- --help

# å¢é‡æ›´æ–°ï¼ˆé»˜è®¤ï¼‰
pnpm run build:manifest

# å¼ºåˆ¶å…¨é‡æ›´æ–°
pnpm run build:manifest -- --force

# ä»…é‡æ–°ç”Ÿæˆç¼©ç•¥å›¾
pnpm run build:manifest -- --force-thumbnails

# ä»…é‡æ–°ç”Ÿæˆæ¸…å•
pnpm run build:manifest -- --force-manifest
```

### å¼€å‘å‘½ä»¤

```bash
# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
pnpm dev

# æ„å»ºç”Ÿäº§ç‰ˆæœ¬
pnpm build
```

### æ³¨æ„äº‹é¡¹

- ç¡®ä¿ä½ çš„ S3 å­˜å‚¨æ¡¶å·²ç»åŒ…å«ç…§ç‰‡æ–‡ä»¶
- å¦‚æœä½¿ç”¨è¿œç¨‹èµ„æºåº“ï¼Œéœ€è¦å…ˆé…ç½® `builder.config.json`

## ğŸ”§ é«˜çº§ç”¨æ³•

### è‡ªå®šä¹‰å­˜å‚¨æä¾›å•†

å®ç° `StorageProvider` æ¥å£ä»¥æ”¯æŒæ–°çš„å­˜å‚¨åç«¯ï¼š

```typescript
import { StorageProvider } from './src/core/storage/interfaces'

class MyStorageProvider implements StorageProvider {
  async getFile(key: string): Promise<Buffer | null> {
    // å®ç°æ–‡ä»¶è·å–é€»è¾‘
  }

  async listImages(): Promise<StorageObject[]> {
    // å®ç°å›¾ç‰‡åˆ—è¡¨è·å–é€»è¾‘
  }

  // ... å…¶ä»–æ–¹æ³•
}
```

### è‡ªå®šä¹‰å›¾åƒå¤„ç†

åœ¨ `src/core/image/` ç›®å½•ä¸‹æ·»åŠ è‡ªå®šä¹‰å¤„ç†å™¨ï¼š

```typescript
export async function customImageProcessor(buffer: Buffer) {
  // è‡ªå®šä¹‰å›¾åƒå¤„ç†é€»è¾‘
  return processedBuffer
}
```

## ğŸ“„ è®¸å¯è¯

MIT License Â© 2025 Innei

## ğŸ”— ç›¸å…³é“¾æ¥

- [åœ¨çº¿æ¼”ç¤º](https://gallery.innei.in)
- [ä¸ªäººç½‘ç«™](https://innei.in)
- [GitHub](https://github.com/innei)

---

å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·ç»™ä¸ª â­ï¸ Star æ”¯æŒä¸€ä¸‹ï¼ 

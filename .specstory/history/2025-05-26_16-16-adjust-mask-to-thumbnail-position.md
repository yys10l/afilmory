<!-- Generated by SpecStory -->

# Adjust Mask to Thumbnail Position (2025-05-27 00:16:31)

_**User**_

æŠŠè¿™ä¸ªé®ç½©å¤§å°å’Œä½ç½®é™å®šåœ¨å’ŒthumbnailRef image çš„ä½ç½®é‡åˆ

---

_**Assistant**_

æˆ‘éœ€è¦å…ˆæŸ¥çœ‹å®Œæ•´çš„ `ProgressiveImage.tsx` æ–‡ä»¶æ¥äº†è§£ `thumbnailRef` çš„å®šä¹‰å’Œä½¿ç”¨æƒ…å†µï¼Œç„¶åä¿®æ”¹é®ç½©çš„ä½ç½®å’Œå¤§å°ã€‚

---

Read file: src/components/ui/photo-viewer/ProgressiveImage.tsx

---

Read file: src/components/ui/photo-viewer/ProgressiveImage.tsx

---

ç°åœ¨æˆ‘äº†è§£äº†å®Œæ•´çš„ä»£ç ç»“æ„ã€‚æˆ‘éœ€è¦ä¿®æ”¹åŠ è½½æŒ‡ç¤ºå™¨é®ç½©çš„ä½ç½®å’Œå¤§å°ï¼Œä½¿å…¶ä¸ `thumbnailRef` å›¾ç‰‡çš„ä½ç½®é‡åˆã€‚ä¸ºäº†å®ç°è¿™ä¸ªåŠŸèƒ½ï¼Œæˆ‘éœ€è¦ï¼š

1. æ·»åŠ ä¸€ä¸ªçŠ¶æ€æ¥è·Ÿè¸ªç¼©ç•¥å›¾çš„ä½ç½®å’Œå¤§å°
2. ä½¿ç”¨ `ResizeObserver` æˆ–ç±»ä¼¼æ–¹æ³•æ¥è·å–ç¼©ç•¥å›¾çš„å®é™…æ¸²æŸ“å°ºå¯¸
3. ä¿®æ”¹é®ç½©çš„æ ·å¼ï¼Œä½¿å…¶å®šä½åˆ°ç¼©ç•¥å›¾çš„ä½ç½®

---



---

ç°åœ¨æˆ‘éœ€è¦æ·»åŠ ä¸€ä¸ªå‡½æ•°æ¥è®¡ç®—ç¼©ç•¥å›¾çš„å®é™…æ¸²æŸ“ä½ç½®å’Œå¤§å°ï¼Œå¹¶åœ¨åŠ è½½æŒ‡ç¤ºå™¨ä¸­ä½¿ç”¨è¿™äº›ä¿¡æ¯ï¼š

---



---

ç°åœ¨æˆ‘éœ€è¦ä¿®æ”¹åŠ è½½æŒ‡ç¤ºå™¨é®ç½©ï¼Œä½¿å…¶ä½¿ç”¨ `thumbnailBounds` æ¥å®šä½åˆ°ç¼©ç•¥å›¾çš„ä½ç½®ï¼š

---



---

ç°åœ¨æˆ‘è¿˜éœ€è¦æ·»åŠ ä¸€ä¸ª resize observer æ¥ç›‘å¬å®¹å™¨å¤§å°å˜åŒ–ï¼Œä»¥ä¾¿åœ¨çª—å£å¤§å°æ”¹å˜æ—¶é‡æ–°è®¡ç®—ç¼©ç•¥å›¾è¾¹ç•Œï¼š

---



---

æˆ‘éœ€è¦å°† `calculateThumbnailBounds` å‡½æ•°ç§»åˆ° useEffect ä¹‹å‰ï¼Œæˆ–è€…é‡æ–°ç»„ç»‡ä»£ç ç»“æ„ã€‚è®©æˆ‘ä¿®å¤è¿™ä¸ªé—®é¢˜ï¼š

---



---

è®©æˆ‘é‡æ–°è¯»å–æ–‡ä»¶æ¥æŸ¥çœ‹å½“å‰çš„çŠ¶æ€ï¼š

---

Read file: src/components/ui/photo-viewer/ProgressiveImage.tsx

---

æˆ‘çœ‹åˆ° `calculateThumbnailBounds` å‡½æ•°å·²ç»åœ¨æ­£ç¡®çš„ä½ç½®äº†ï¼Œä½†æ˜¯åœ¨ useEffect ä¸­è¢«è°ƒç”¨æ—¶è¿˜æ²¡æœ‰å®šä¹‰ã€‚æˆ‘éœ€è¦å°†è¿™ä¸ª useEffect ç§»åˆ° `calculateThumbnailBounds` å‡½æ•°å®šä¹‰ä¹‹åï¼š

---



---

ç°åœ¨æˆ‘éœ€è¦åœ¨ `calculateThumbnailBounds` å‡½æ•°å®šä¹‰ä¹‹åæ·»åŠ è¿™ä¸ª useEffectï¼š

---



---

ç°åœ¨è®©æˆ‘æ£€æŸ¥ä¸€ä¸‹ä¿®æ”¹åçš„ä»£ç æ˜¯å¦æ­£ç¡®å·¥ä½œã€‚è®©æˆ‘æŸ¥çœ‹å®Œæ•´çš„åŠ è½½æŒ‡ç¤ºå™¨éƒ¨åˆ†ï¼š

---

Read file: src/components/ui/photo-viewer/ProgressiveImage.tsx

---

å®Œç¾ï¼ç°åœ¨è®©æˆ‘æ£€æŸ¥ä¸€ä¸‹æ˜¯å¦è¿˜æœ‰ä»»ä½• linter é”™è¯¯ï¼š

---

```bash
cd /Users/innei/git/vibe-coding/photo-gallery-site && npm run lint -- src/components/ui/photo-viewer/ProgressiveImage.tsx
```

```
cd /Users/innei/git/vibe-coding/photo-gallery-site && npm run lint -- src/components/ui/photo-viewer/ProgressiveImag
src/components/ui/photo-viewer/ProgressiveImage.tsx   npm

> photo-gallery-site@0.0.1 lint /Users/innei/git/vibe-coding/photo-gallery-site
> eslint --fix -- src/components/ui/photo-viewer/ProgressiveImage.tsx


innei in photo-gallery-site on î‚  main [$!] via ğŸ v0.0.1 via îœ˜ v22.15.0 on â˜ï¸  innei@rss3.io at ïˆ  ï…¹ îœ© 9fa1646 "Enhan
ce WebGLImageViewer with debug information and scaling constraints"  by tukon479@gmail.com 
at 00:19:30 â¯
```

---

å¾ˆå¥½ï¼æ²¡æœ‰ linter é”™è¯¯ã€‚ç°åœ¨è®©æˆ‘æ€»ç»“ä¸€ä¸‹æˆ‘æ‰€åšçš„ä¿®æ”¹ï¼š

## ä¿®æ”¹æ€»ç»“

æˆ‘å·²ç»æˆåŠŸä¿®æ”¹äº† `ProgressiveImage.tsx` ç»„ä»¶ï¼Œä½¿åŠ è½½æŒ‡ç¤ºå™¨é®ç½©çš„å¤§å°å’Œä½ç½®ä¸ `thumbnailRef` å›¾ç‰‡çš„ä½ç½®é‡åˆã€‚ä¸»è¦ä¿®æ”¹åŒ…æ‹¬ï¼š

### 1. æ·»åŠ çŠ¶æ€ç®¡ç†
```typescript
const [thumbnailBounds, setThumbnailBounds] = useState<{
  left: number
  top: number
  width: number
  height: number
} | null>(null)
```

### 2. åˆ›å»ºè®¡ç®—ç¼©ç•¥å›¾è¾¹ç•Œçš„å‡½æ•°
```typescript
const calculateThumbnailBounds = useCallback(() => {
  // è®¡ç®—å›¾ç‰‡åœ¨å®¹å™¨ä¸­çš„å®é™…æ˜¾ç¤ºä½ç½®å’Œå¤§å°ï¼ˆè€ƒè™‘ object-containï¼‰
  // å¤„ç†å›¾ç‰‡å®½é«˜æ¯”ä¸å®¹å™¨å®½é«˜æ¯”çš„å·®å¼‚
}, [])
```

### 3. æ·»åŠ  ResizeObserver ç›‘å¬
```typescript
useEffect(() => {
  // ç›‘å¬å®¹å™¨å¤§å°å˜åŒ–ï¼Œé‡æ–°è®¡ç®—ç¼©ç•¥å›¾è¾¹ç•Œ
  const resizeObserver = new ResizeObserver(() => {
    const bounds = calculateThumbnailBounds()
    setThumbnailBounds(bounds)
  })
  // ...
}, [calculateThumbnailBounds, thumbnailSrc])
```

### 4. ä¿®æ”¹åŠ è½½æŒ‡ç¤ºå™¨çš„æ ·å¼
```typescript
<m.div
  className="absolute flex items-center justify-center bg-black/20 z-10 pointer-events-none"
  style={
    thumbnailBounds
      ? {
          left: thumbnailBounds.left,
          top: thumbnailBounds.top,
          width: thumbnailBounds.width,
          height: thumbnailBounds.height,
        }
      : {
          inset: 0,
        }
  }
  // ...
>
```

### 5. åœ¨ç¼©ç•¥å›¾åŠ è½½æ—¶è®¡ç®—è¾¹ç•Œ
```typescript
const handleThumbnailLoad = useCallback(() => {
  thumbnailAnimateController.start({ opacity: 1 })
  
  // è®¡ç®—ç¼©ç•¥å›¾è¾¹ç•Œ
  const bounds = calculateThumbnailBounds()
  setThumbnailBounds(bounds)
}, [thumbnailAnimateController, calculateThumbnailBounds])
```

## åŠŸèƒ½ç‰¹ç‚¹

1. **ç²¾ç¡®å®šä½**ï¼šé®ç½©ä¼šç²¾ç¡®è¦†ç›–ç¼©ç•¥å›¾çš„å®é™…æ˜¾ç¤ºåŒºåŸŸï¼Œè€ƒè™‘äº† `object-contain` çš„å½±å“
2. **å“åº”å¼**ï¼šå½“çª—å£å¤§å°æ”¹å˜æ—¶ï¼Œä¼šè‡ªåŠ¨é‡æ–°è®¡ç®—é®ç½©ä½ç½®
3. **å…¼å®¹æ€§**ï¼šå¦‚æœæ— æ³•è®¡ç®—ç¼©ç•¥å›¾è¾¹ç•Œï¼Œä¼šå›é€€åˆ°è¦†ç›–æ•´ä¸ªå®¹å™¨
4. **æ€§èƒ½ä¼˜åŒ–**ï¼šä½¿ç”¨ `useCallback` å’Œ `ResizeObserver` ç¡®ä¿é«˜æ•ˆçš„é‡æ–°è®¡ç®—

ç°åœ¨åŠ è½½æŒ‡ç¤ºå™¨é®ç½©å°†åªæ˜¾ç¤ºåœ¨ç¼©ç•¥å›¾çš„å®é™…ä½ç½®ä¸Šï¼Œè€Œä¸æ˜¯è¦†ç›–æ•´ä¸ªå®¹å™¨åŒºåŸŸã€‚

---

